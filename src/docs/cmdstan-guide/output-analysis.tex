
\chapter{Print Command for Output Analysis}\label{print-command.chapter}

\noindent
Stan is distributed with a print command that is able to read in the
output of one or more Markov chains and summarize the posterior fits.
This operation mimics the \code{print(fit)} command in RStan, which
itself was modeled on the print functions from R2WinBUGS and R2jags.

\section{Building the Print Command}

Stan's \code{print} command is built along with \code{stanc} into the
\code{bin} directory.  It can be compiled directly using the makefile
as follows from the home directory into which Stan was unpacked (here
written as \code{<stan-home>}).
%
\begin{quote}
\begin{Verbatim}
> cd <stan-home>
> make bin/print
\end{Verbatim}
\end{quote}
%
All the usual compiler options from Stan's makefile apply, such as
\code{O=\farg{N}} to set optimization level to \farg{N}, and
\code{CC=clang++} to set the compilation to use clang. 

\section{Running the Print Command}

The print command is executed on one or more samples.csv files.  These
files may be provided as command-line arguments separated by spaces.
That means that wildcards may be used, as they will be replaced by
space-separated file names by the operating system's command-line
interpreter. 

Suppose there are three samples files in a directory generated by
fitting a negative binomial model to a small data set.
%
\begin{quote}
\begin{Verbatim}[fontshape=sl]
> ls samples*.csv
\end{Verbatim}
%
\begin{Verbatim}
samples1.csv	samples2.csv	samples3.csv
\end{Verbatim}
%
\begin{Verbatim}[fontshape=sl]
> bin/print samples*.csv
\end{Verbatim}
\end{quote}
%
The result of \code{bin/print} is displayed in
\reffigure{bin-print-eg}.%
%
\footnote{RStan's and PyStan's output analysis print may be different
  than that in the command-line version of Stan.}
%
\begin{figure}
\begin{Verbatim}[fontsize=\footnotesize]
   Inference for Stan model: negative_binomial_model
   1 chains: each with iter=(1000); warmup=(0); thin=(1); 1000 iterations saved.

   Warmup took (0.054) seconds, 0.054 seconds total
   Sampling took (0.059) seconds, 0.059 seconds total

                   Mean     MCSE   StdDev    5%   50%   95%  N_Eff  N_Eff/s  R_hat
   lp__             -14  6.2e-02  1.0e+00   -16   -14   -13    283     4773   1.00
   accept_stat__   0.88  5.6e-03  1.8e-01  0.51  0.95   1.0   1000    16881   1.00
   stepsize__      0.30  1.3e-15  8.9e-16  0.30  0.30  0.30   0.50      8.5   1.00
   treedepth__      1.4  2.6e-02  8.0e-01  0.00   1.0   2.0    946    15978   1.00
   n_divergent__    1.4  0.0e+00  0.0e+00  0.00   0.0   0.0   1000    16949   1.00
   alpha             17  1.8e+00  2.5e+01   1.9   9.5    50    181     3054   1.00
   beta              10  1.1e+00  1.4e+01   1.2   6.2    31    181     3057   1.00

   Samples were drawn using hmc with nuts.
   For each parameter, N_Eff is a crude measure of effective sample size,
   and R_hat is the potential scale reduction factor on split chains (at 
   convergence, R_hat=1).
\end{Verbatim}
\vspace*{-6pt}
\caption{\small\it Example output from \code{bin/print}.  The model
  parameters are \code{alpha} and \code{beta}.  The values for each
  quantity are the posterior means, standard deviations, and
  quantiles, along with Monte-Carlo standard error, effective sample
  size estimates (per second), and convergence diagnostic statistic.
  These values are all estimated from samples. In addition to the
  parameters, the value \code{lp\_\_} is the total log probability
  computed by the model (up to an additive constant).  The quantity
  \code{accept\_stat\_\_} is the NUTS acceptance statistic used by
  NUTS for slice and Metropolis rejection, \code{stepsize\_\_} the
  step size used by NUTS in its Hamiltonian simulation, and
  \code{treedepth\_\_} is the depth of tree used by NUTS, which is the
  log (base 2) of the number of leapfrog steps taken during the
  Hamiltonian simulation.  \code{n\_divergent\_\_} gives the number
  of leapfrog iterations with diverging error; because NUTS terminates
  at the first divergent iteration this should always be either 0 or 1.}
\label{bin-print-eg.figure}
\end{figure}
%\end{quote}
%
The posterior is skewed to the high side, resulting in posterior means
($\alpha=17$ and $\beta=10$) that are a long way away from the posterior
medians ($\alpha=9.5$ and $\beta=6.2$);  the posterior median is the
value listed under \code{50\%}, which is the 50th percentile of the
posterior values.

For Windows, the forward slash in paths need to be converted to backslashes.

\section{Command-line Options}

In addition to the filenames, \code{print} includes three flags to customize the output.  

\begin{description}
\longcmd{help}
{Prints usage information}
{No help output by default}
%
\cmdarg{sig\_figs}{int}
{Sets the number of significant figures displayed in the output}
{Valid values: 0 \textless sig\_figs}
{default = \code{2} }
%
\cmdarg{autocorr}{int}
{Calculates and then displays the autocorrelation of the specified chain}
{Valid values: Any integer matching a chain index}
{No autocorrelation output by default}
%
\end{description}
