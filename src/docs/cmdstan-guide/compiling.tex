\chapter{Compiling \CmdStan Exectuables}\label{compiling.chapter}

\noindent
Preparing a \Stan program to be run involves two steps,
%
\begin{enumerate}
\item translating the \Stan program to \Cpp, and
\item compiling the resulting \Cpp to an executable.
\end{enumerate}
%
This chapter discusses both steps, as well as their encapsulation into
a single make target.  

\section{Translating and Compiling through {\tt\bfseries make}}\label{make-models.section}

The simplest way to compile a \CmdStan program is through the \code{make}
build tool, which encapsulates the translation and compilation step
into a single command.  The commands making up the \code{make} target
for compiling a model are described in the following sections, and the
following chapter describes how to run a compiled model.

\subsection{Translating and Compiling Test Models}

There are a number of example models distributed with \CmdStan which
unpack into the path \code{stan/example-models}.  To build the simple
example
\nolinkurl{stan/example-models/basic\_estimators/bernoulli.stan}, the
following call to \code{make} suffices.  First the directory is
changed to \CmdStan's home directory by replacing
\code{<cmdstan-home>} with the appropriate path.
%
\begin{quote}
\begin{Verbatim}[fontshape=sl]
> cd <cmdstan-home>
\end{Verbatim}
\end{quote}
%
The following call will build an executable form of the Bernoulli
estimator. On Windows, replace \code{bernoulli} with \code{bernoulli.exe}.
%
\begin{quote}
\begin{Verbatim}[fontshape=sl]
> make stan/example-models/basic_estimators/bernoulli
\end{Verbatim}
\end{quote}
%
This will translate the model \code{bernoulli.stan} to a \Cpp file and
compile a \CmdStan program using the generated \Cpp file, putting the
executable in
\nolinkurl{stan/example-models/basic_distributions/bernoulli(.exe)}.

\subsection{Dependencies in {\tt\bfseries make}}

When executing a \code{make} target, all its dependencies are checked
to see if they are up to date, and if they are not, they are rebuilt.
If the \code{make} target to build the Bernoulli estimator is invoked
a second time, it will see that it is up to date, and will not
recompile the program.

If the file containing the \Stan program is updated, the next call to
\code{make} will rebuild the \CmdStan executable.



\subsection{Getting Help from the {\tt makefile}}

\CmdStan's \code{makefile}, which contains the top-level instructions to
\code{make}, provides extensive help in terms of targets and options.
It is located at the top-level of the distribution, so first change
directories to that location.
%
\begin{quote}
\begin{Verbatim}[fontshape=sl]
> cd <cmdstan-home>
\end{Verbatim}
\end{quote} 
and then invoke make with the target \code{help},

\begin{quote}
\begin{Verbatim}[fontshape=sl]
> make help
\end{Verbatim}
\end{quote}


\subsection{Options to \code{make}}

\CmdStan allows users to change compilers, library versions for Eigen
and Boost, as well as compilation options such as optimization.

For a full list of options, see \refappendix{make-options}



\subsubsection{Clean Targets}

A very useful target is \code{clean-all}, invoked as
%
\begin{quote}
\begin{Verbatim}[fontshape=sl]
> make clean-all
\end{Verbatim}
\end{quote}
%
This removes the \CmdStan tools. This step is necessary when changing
compilers or other \code{make} options.
